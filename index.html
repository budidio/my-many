<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keuangan Bulanan</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f2f6fc;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .container {
      max-width: 500px;
      margin: 30px auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h2 { text-align: center; color: #1e3a8a; margin-bottom: 10px; }
    input, button {
      width: 100%; padding: 10px; margin: 5px 0;
      border-radius: 8px; border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      background: #3b82f6; color: #fff; border: none;
      cursor: pointer; transition: 0.3s;
    }
    button:hover { background: #2563eb; }
    #dashboard { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td {
      border-bottom: 1px solid #ddd;
      text-align: left; padding: 8px;
      font-size: 13px;
    }
    canvas { width: 100% !important; height: 180px !important; }
    .total-box {
      text-align: center; background: #e0f2fe;
      border-radius: 10px; padding: 10px; margin-top: 10px;
      color: #1e3a8a; font-weight: bold;
    }
    @media (max-width: 600px) {
      .container { margin: 15px; padding: 15px; }
      canvas { height: 150px !important; }
    }
  </style>
</head>
<body>

<div class="container" id="loginBox">
  <h2>Login Admin</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Masuk</button>
  <p id="loginError" style="color:red;display:none;text-align:center;font-size:13px;">Username atau password salah</p>
</div>

<div class="container" id="dashboard">
  <h2>Keuangan Bulanan</h2>

  <input type="text" id="deskripsi" placeholder="Keterangan">
  <input type="number" id="nominal" placeholder="Nominal (Rp)">
  <select id="jenis">
    <option value="pemasukan">Pemasukan</option>
    <option value="pengeluaran">Pengeluaran</option>
  </select>
  <button id="tambahBtn">Tambah Data</button>

  <div class="total-box" id="totalBox">Total: Rp 0</div>

  <canvas id="grafik"></canvas>

  <table>
    <thead>
      <tr><th>Tanggal</th><th>Keterangan</th><th>Nominal</th><th>Aksi</th></tr>
    </thead>
    <tbody id="tabelData"></tbody>
  </table>
</div>

<!-- Firebase SDK compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Konfigurasi Firebase kamu
  const firebaseConfig = {
    apiKey: "AIzaSyC7TL5MZ7ufqpTQi0eXw9OYV7sp7RU05w",
    authDomain: "keuangan-app-ff36d.firebaseapp.com",
    projectId: "keuangan-app-ff36d",
    storageBucket: "keuangan-app-ff36d.appspot.com",
    messagingSenderId: "583666780989",
    appId: "1:583666780989:web:f84a73839ca0a76d6c1354"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Elemen DOM
  const loginBox = document.getElementById('loginBox');
  const dashboard = document.getElementById('dashboard');
  const username = document.getElementById('username');
  const password = document.getElementById('password');
  const loginBtn = document.getElementById('loginBtn');
  const loginError = document.getElementById('loginError');
  const deskripsi = document.getElementById('deskripsi');
  const nominal = document.getElementById('nominal');
  const jenis = document.getElementById('jenis');
  const tambahBtn = document.getElementById('tambahBtn');
  const tabelData = document.getElementById('tabelData');
  const totalBox = document.getElementById('totalBox');
  let chart;

  // Login lokal
  loginBtn.onclick = () => {
    if (username.value === 'admin' && password.value === '1122aabb') {
      loginBox.style.display = 'none';
      dashboard.style.display = 'block';
      muatData();
    } else {
      loginError.style.display = 'block';
    }
  };

  // Tambah data ke Firestore
  tambahBtn.onclick = async () => {
    if (!deskripsi.value || !nominal.value) return alert("Lengkapi data!");
    await db.collection("transaksi").add({
      deskripsi: deskripsi.value,
      nominal: parseInt(nominal.value),
      jenis: jenis.value,
      tanggal: new Date().toISOString()
    });
    deskripsi.value = '';
    nominal.value = '';
    muatData();
  };

  // Hapus data
  async function hapusData(id) {
    await db.collection("transaksi").doc(id).delete();
    muatData();
  }

  // Ambil dan tampilkan data
  async function muatData() {
    const snapshot = await db.collection("transaksi").orderBy("tanggal", "asc").get();
    tabelData.innerHTML = '';
    let total = 0;
    const labels = [];
    const dataPoints = [];

    snapshot.forEach(doc => {
      const data = doc.data();
      const tgl = new Date(data.tanggal).toLocaleDateString('id-ID');
      const warna = data.jenis === 'pemasukan' ? 'green' : 'red';
      if (data.jenis === 'pemasukan') total += data.nominal;
      else total -= data.nominal;

      tabelData.innerHTML += `
        <tr>
          <td>${tgl}</td>
          <td>${data.deskripsi}</td>
          <td style="color:${warna}">Rp ${data.nominal.toLocaleString()}</td>
          <td><button onclick="hapusData('${doc.id}')">üóëÔ∏è</button></td>
        </tr>`;
      labels.push(tgl);
      dataPoints.push(total);
    });

    totalBox.innerText = `Total: Rp ${total.toLocaleString()}`;

    if (chart) chart.destroy();
    const ctx = document.getElementById('grafik').getContext('2d');
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Perkembangan Keuangan',
          data: dataPoints,
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59,130,246,0.2)',
          borderWidth: 2,
          pointRadius: 3,
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, suggestedMax: Math.max(...dataPoints, 100000) }
        }
      }
    });
  }
</script>
</body>
</html>
